name: Retrieve Secrets from Vault

on: push

permissions:
    id-token: write
    contents: read 

jobs:
  retrieve-secrets:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Retrieve Secret
      id: secretdata
      uses: hashicorp/vault-action@v2.4.0
      with:
        method: jwt
        url: "https://${{ secrets.VAULT_ADDR }}"
        role: "github-actions"
        secrets: |
            ${{ secrets.VAULT_SECRET_PATH }} ${{ secrets.VAULT_SECRET_KEY }} | client_id;
            ${{ secrets.VAULT_SECRET_PATH }} ${{ secrets.CONTAINER_NAME }} | container_name;
            ${{ secrets.VAULT_SECRET_PATH }} ${{ secrets.RESOURCE_GROUP_NAME }} | resource_group_name;
            ${{ secrets.VAULT_SECRET_PATH }} ${{ secrets.STORAGE_ACCOUNT }} | storage_account;
            ${{ secrets.VAULT_SECRET_PATH }} ${{ secrets.SUBSCRIPTION_ID }} | subscription_id;
            ${{ secrets.VAULT_SECRET_PATH }} ${{ secrets.TENANT_ID }} | tenant_id

    
    - name: Print Secret Data
      run: |
        echo '${{ steps.secretdata.outputs.client_id }}'
        echo '${{ steps.secretdata.outputs.container_name }}'
        echo '${{ steps.secretdata.outputs.storage_account }}'
        echo '${{ steps.secretdata.outputs.subscription_id }}'
        echo '${{ steps.secretdata.outputs.tenant_id }}'
        
    